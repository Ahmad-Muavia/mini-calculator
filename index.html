<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Scientific Calculator</title>
<style>
  :root{
    --bg: #0b0f14;
    --card: rgba(255,255,255,0.06);
    --glass: rgba(255,255,255,0.06);
    --accent: #67e8f9;
    --accent-2: #7c3aed;
    --muted: rgba(255,255,255,0.55);
    --neon: 0 6px 30px rgba(103,232,249,0.12), 0 0 18px rgba(124,58,237,0.07);
  }
  *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#071018 0%, #08121a 100%); color:#e6eef8}
  .wrap{display:flex;gap:22px;align-items:flex-start;justify-content:center;padding:28px;}
  .calc{
    width:400px;
    border-radius:16px;
    padding:18px;
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    backdrop-filter: blur(8px) saturate(120%);
    box-shadow: var(--neon);
    position:relative;
  }
  .topbar{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-bottom:12px}
  .title{font-weight:600;letter-spacing:0.2px}
  .controls{display:flex;gap:8px;align-items:center}
  .btn{
    border:none;padding:8px 10px;border-radius:10px;background:rgba(255,255,255,0.03);color:var(--muted);cursor:pointer;transition:all .14s; font-weight:600;
  }
  .btn:hover{transform:translateY(-4px); box-shadow:0 8px 18px rgba(0,0,0,0.4)}
  #modeToggle{background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#02111a}
  #display{
    width:100%; height:70px; border-radius:12px; border:none; outline:none;
    padding:10px 14px; font-size:28px; background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    color:#eaf6ff; text-align:right; transition:all .18s; letter-spacing:0.6px;
    box-shadow: inset 0 -2px 10px rgba(0,0,0,0.45);
  }
  .display-anim{ animation: flash .38s ease; }
  @keyframes flash{ 0%{transform:scale(0.995);opacity:.6} 100%{transform:none;opacity:1} }

  .keys{
    margin-top:14px;
    display:grid;
    grid-template-columns: repeat(5, 1fr);
    gap:10px;
  }

  .key{
    height:54px; border-radius:10px; border:none; background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    color:#dff6ff; font-weight:600; cursor:pointer; transition:all .12s; box-shadow: 0 6px 18px rgba(2,10,20,0.6);
  }
  .key:hover{ transform:translateY(-4px); filter:brightness(1.08); box-shadow: 0 12px 36px rgba(2,10,20,0.7); }
  .key:active{ transform:scale(.96) translateY(1px); }

  .op{ background:linear-gradient(90deg,#ffb86b,#ff6b6b); color:#041014; box-shadow: 0 10px 30px rgba(255,107,107,0.14) }
  .sc{ background:linear-gradient(90deg,#67e8f9,#7c3aed); color:#02111a; box-shadow: 0 10px 30px rgba(103,232,249,0.08) }
  .eq{ background:linear-gradient(90deg,#5efc82,#06b6a4); color:#04211e; box-shadow:0 10px 30px rgba(94,252,130,0.08) }
  .clear{ background:linear-gradient(90deg,#ff6b6b,#ff9a9a); color:#041014; }

  /* History panel */
  .history{
    width:320px; max-height:620px; overflow:auto;
    border-radius:14px; padding:12px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    backdrop-filter: blur(6px); box-shadow: 0 8px 30px rgba(0,0,0,0.6);
  }
  .hist-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .hist-list{display:flex;flex-direction:column;gap:8px}
  .hist-item{padding:8px;border-radius:10px;background:rgba(0,0,0,0.18);cursor:pointer}
  .hist-item small{display:block;color:var(--muted);font-size:12px}
  .muted{color:var(--muted);}

  /* responsive */
  @media(max-width:900px){
    .wrap{flex-direction:column;align-items:center;padding:18px}
    .history{width:92%}
    .calc{width:92%}
    .keys{grid-template-columns: repeat(4, 1fr) }
  }
</style>
</head>
<body>

<div class="wrap">
  <div class="calc" id="calculator">
    <div class="topbar">
      <div>
        <div class="title">Scientific Calculator</div>
        <div class="muted" style="font-size:12px">Glass ‚Ä¢ Neon ‚Ä¢ Sound ‚Ä¢ Vibration ‚Ä¢ History</div>
      </div>
      <div class="controls">
        <button class="btn" id="modeToggle" onclick="toggleMode()">üåôD/‚òÄÔ∏èL</button>
      </div>
    </div>

    <input id="display" placeholder="0" readonly />

    <div class="keys" id="keys">
      <!-- scientific -->
      <button class="key sc" onclick="applyFunc('sin')">sin</button>
      <button class="key sc" onclick="applyFunc('cos')">cos</button>
      <button class="key sc" onclick="applyFunc('tan')">tan</button>
      <button class="key sc" onclick="applyFunc('sqrt')">‚àö</button>
      <button class="key sc" onclick="applyFunc('ln')">ln</button>

      <button class="key sc" onclick="press('(')">(</button>
      <button class="key sc" onclick="press(')')">)</button>
      <button class="key sc" onclick="press('œÄ')">œÄ</button>
      <button class="key sc" onclick="press('e')">e</button>
      <button class="key sc" onclick="percent()">%</button>

      <!-- numbers / ops -->
      <button class="key" onclick="press('7')">7</button>
      <button class="key" onclick="press('8')">8</button>
      <button class="key" onclick="press('9')">9</button>
      <button class="key op" onclick="press('/')">√∑</button>
      <button class="key clear" onclick="factorial()">x!</button>

      <button class="key" onclick="press('4')">4</button>
      <button class="key" onclick="press('5')">5</button>
      <button class="key" onclick="press('6')">6</button>
      <button class="key op" onclick="press('*')">√ó</button>
      <button class="key" onclick="applyFunc('pow')">x ∏</button>

      <button class="key" onclick="press('1')">1</button>
      <button class="key" onclick="press('2')">2</button>
      <button class="key" onclick="press('3')">3</button>
      <button class="key op" onclick="press('-')">‚àí</button>
      <button class="key" onclick="applyFunc('exp')">exp</button>

      <button class="key" onclick="press('0')">0</button>
      <button class="key" onclick="press('.')">.</button>
      <button class="key eq" onclick="calc()">=</button>
      <button class="key op" onclick="press('+')">+</button>
      <button class="key" onclick="applyFunc('abs')">abs</button>
      <button class="btn" id="clearAllTop" title="Clear" onclick="clearAll()">C</button>

    </div>
  </div>

  <div class="history" id="historyPanel">
    <div class="hist-head">
      <div style="font-weight:700">History</div>
      <div class="muted" id="histCount">0</div>
    </div>
    <div class="hist-list" id="histList"></div>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button class="btn" onclick="clearHistory()">Clear History</button>
      <button class="btn" onclick="exportHistory()">Export</button>
    </div>
  </div>
</div>
<script>
const d = document.getElementById('display');
let history = JSON.parse(localStorage.getItem('calc_history_v2') || '[]');
let lastAns = history.length ? history[0].result : '';

/* ------------------ sound + vibration ------------------ */
let audioCtx = null;
function ensureAudio(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}
function playClick(){
  try{
    ensureAudio();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.frequency.value = 700;
    g.gain.value = 0.03;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    setTimeout(()=>o.stop(),70);
  }catch(e){}
}
function vibrateShort(){ if(navigator.vibrate) navigator.vibrate(20); }

/* ------------------ input ------------------ */
function press(v){
  playClick(); vibrateShort();
  if(v === 'œÄ') v = Math.PI;
  if(v === 'e') v = Math.E;
  if(d.value === '0') d.value = '';
  d.value += v;
  animateDisplay();
}

function clearAll(){
  playClick(); vibrateShort();
  d.value = '';
  animateDisplay();
}

function back(){
  playClick(); vibrateShort();
  d.value = d.value.slice(0,-1);
  animateDisplay();
}

/* ------------------ scientific ------------------ */
function applyFunc(name){
  playClick(); vibrateShort();
  const map = {
    sin: 'sin(',
    cos: 'cos(',
    tan: 'tan(',
    sqrt: 'Math.sqrt(',
    ln: 'Math.log(',
    exp: 'Math.exp(',
    abs: 'Math.abs('
  };

  if(name === 'pow'){
    d.value += '^';
  } else if(map[name]){
    d.value += map[name];
  }
  animateDisplay();
}

function percent(){
  playClick(); vibrateShort();
  try{
    let v = evalSafe(d.value);
    d.value = String(v / 100);
    animateDisplay();
  }catch(e){
    d.value = 'Error';
  }
}

/* ------------------ factorial ------------------ */
function factorial(){
  playClick(); vibrateShort();
  try{
    let n = evalSafe(d.value);
    if(n < 0 || n % 1 !== 0) throw 0;
    let r = 1;
    for(let i=2;i<=n;i++) r*=i;
    d.value = r;
    animateDisplay();
  }catch(e){
    d.value = 'Error';
  }
}

/* ------------------ animation ------------------ */
function animateDisplay(){
  d.classList.remove('display-anim');
  void d.offsetWidth;
  d.classList.add('display-anim');
}

/* ------------------ safe eval ------------------ */
function replaceFriendly(expr){
  return expr
    .replace(/\^/g,'**')
    .replace(/sin\(/g,'Math.sin(')
    .replace(/cos\(/g,'Math.cos(')
    .replace(/tan\(/g,'Math.tan('));
}

function evalSafe(expr){
  expr = replaceFriendly(expr);
  return Function('"use strict"; return ('+expr+')')();
}

/* ------------------ calculate ------------------ */
function calc(){
  playClick(); vibrateShort();
  try{
    let result = evalSafe(d.value);
    d.value = Number(result.toPrecision(12));
    lastAns = d.value;
    animateDisplay();
  }catch(e){
    d.value = 'Error';
  }
}

/* ------------------ history ------------------ */
function renderHistory(){
  const el = document.getElementById('histList');
  el.innerHTML = '';
  history.forEach(h=>{
    const div = document.createElement('div');
    div.className = 'hist-item';
    div.innerHTML = `<b>${h.result}</b><small>${h.expr}</small>`;
    div.onclick = ()=> d.value = h.result;
    el.appendChild(div);
  });
  document.getElementById('histCount').innerText = history.length;
}
renderHistory();

/* ------------------ keyboard ------------------ */
window.addEventListener('keydown',e=>{
  if(e.key==='Enter') calc();
  else if(e.key==='Backspace') back();
  else if(/[0-9.+\-*/^()]/.test(e.key)) press(e.key);
});
</script>


</body>
</html>
